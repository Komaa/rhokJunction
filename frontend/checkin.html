<!DOCTYPE html>
<html lang="en">
	<head>
		<title>
			Finnair
		</title>
		<style class="anchorjs"></style>
		<link href='http://fonts.googleapis.com/css?family=Oswald:400,300' rel='stylesheet'>

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">

		<!-- Optional theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" integrity="sha384-aUGj/X2zp5rLCbBxumKTCw2Z50WgIr1vs/PFN4praOTvYXWlVyh2UtNUU0KAUhAX" crossorigin="anonymous">
		<link href="./css/style.css" rel="stylesheet">
		<!--Import materialize.css-->
		<link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>

		<link rel="stylesheet" type="text/css" href="css/jquery.seat-charts.css">
		<link rel="stylesheet" type="text/css" href="css/styleMap.css">
	</head>

<body>
    <div class="header">
      <div class="container">
        <a href="index.html" class="logo-icon">
          <img src="./images/logo.png" height="40" width="120">
        </a>

        <ul class="nav nav-pills menu">
        	<!-- Nav bar pills menu item  MAKEUP-->
			<li role="presentation" class="dropdown">
	    		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
	      Search Flights <span class="caret"></span></a>
	    		
	    		<ul class="dropdown-menu">
	    			<li role="presentation"><a href="#">Loyalty Promo</a></li>
					<li role="presentation"><a href="#">Popular Destination</a></li>
				    <li role="presentation"><a href="#" class="show_search">Search</a></li>
	    		</ul>
	  		</li>

	  		<!-- Nav bar pills menu item SKINCARE -->
	  		<li role="presentation" class="dropdown">
	    		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
	      Manage Booking<span class="caret"></span></a>
	    		
	    		<ul class="dropdown-menu">
	    			<!-- First level dropdown menu -->
					<li role="presentation"><a href="checkin.html" class="checkin-btn">Check In</a></li>
					<li role="presentation"><a href="#">View Ticket</a></li>
				    <li role="presentation"><a href="#">Cancel or Change</a></li>
				    
	    		</ul>
	  		</li>

	  		<!-- Last menu item SPECIAL OFFERS YAY!!!!!!-->
	  		<li style="background-color:orange;" role="presentation">
	    		<a style="color: white;" href="#" role="button">Special Offers</a>
	    	</li>
	  		

		</ul>
      </div>
    </div>




	<div class="checkin-verify" style="">
		<div class="container">
			
				
			<div class="form-horizontal">
				<h3>Your Booking Reference</h3>

				<!---<label class="col-xs-5 control-label" for="booking_reference">Your Booking Reference</label> -->
				<div class="row">
					<div class="col-xs-5">
						<input id="booking_reference" name="booking_reference" type="text" placeholder="Example: ABNH12" required=""> 
					</div>
				</div>

				<div class="row">
					<div class="col-xs-offset-4 col-xs-1">
						<a class="waves-effect waves-light btn" id="get_booking_btn" >Submit</a>
					</div>   
				</div>
			</div>
	</div>
	</div>

	<div class="select_place" style="display:none">
		<div class="container">
			<div class="row">
				<h3>Welcome on board!</h3>
				<h4>Do you want to select your seat?</h4>
				<div class="col-xs-4">
					<a class="waves-effect waves-light btn" id="seat_map_btn" >Choose the seat</a>
				</div>
				<div class="col-offset-xs-2 col-xs-4">
					<a class="waves-effect waves-light btn" id="use_sezi_btn" >Use SEZI</a>
				</div>   

			</div>
		</div>
	</div>

	<div class="checkin" style="display:none">
		<div class="container">

			<div class="col-xs-offset-2 col-xs-10" style="margin:20px; text-align:center">
			<h3>Tell us what type of traveller you are?</h3>
			<h6> We will help you meet like-minded people.</h6>
			</div>

			<form id="checkin_form" class="form-horizontal">

				<!-- Departure input-->
				<div class="form-group">
					<div class="row">
				  
					  <div class="col-xs-offset-3 col-xs-4">
					  	<a id="c_btn" class="waves-effect waves-light btn-large category tooltipped" style="background-color:#2ECC71" data-delay="50"
					  	data-tooltip="Choose this category if you want to socialize with fellow Passengers talking about life , Philosophy or even Business" data-position="right">The Chatty</a>
					  </div>

					  <div class="col-xs-offset-3 col-xs-4">
					  	<a id="s_btn" class="waves-effect waves-light btn-large category tooltipped" style="background-color:#F89406" data-delay="50"
					  	data-tooltip="Choose this category if you want to have fun and play some games with your fellow passengers" data-position="right">The Social Gamer</a>
					  </div>	

					  <div class="col-xs-offset-3 col-xs-4">
					  	<a  id="n_btn" class="waves-effect waves-light btn-large category tooltipped" style="background-color:#1E8BC3" data-delay="50"
					  	data-tooltip="Choose this category if you want to be cozy and warm enjoying the the comforts from list of sleeping aids" data-position="right">The Nappy</a>
					  </div>

					  <div class="col-xs-offset-3 col-xs-4">
					  	<a  id="w_btn" class="waves-effect waves-light btn-large category tooltipped" style="background-color:#BF55EC" data-delay="50"
					  	data-tooltip="Choose this category if you want to focus on your work and be in peace" data-position="right">The Workaholic</a>
					  </div>

					  <div class="col-xs-offset-3 col-xs-4">
					  	<a  id="e_btn" class="waves-effect waves-light btn-large category tooltipped" style="background-color:#F4D03F" data-delay="50"
					  	data-tooltip="Choose this category if you are not worried too much about where you have to sit" data-position="right">The Easy Going</a>
					 </div>
					</div>
				</div>
			</form>
		</div>
	</div>

	<div class="seat_map" style="display:none">
		<div class="container">
			<form id="productForm" action="http://localhost:8080/api/reservation" method="post">

		<!-- <div id="page1" class="col-md-8">
			<div class="row">
			
			   
			   


						<div class="form-group">
					        <label class="col-xs-3 control-label">Sezi</label>
					        <div class="col-xs-5 selectContainer">
					            <select class="form-control" name="sel_mood" id="sel_mood">
					                <option value="">Choose a class</option>
					                <option value="chatty-class">Chatty</option>
					                <option value="social-class">Social Gamer</option>
					                <option value="nappy-class">Nappy</option>
					                <option value="workaholic-class">Workaholic</option>
					                <option value="easygoing-class">EasyGoing</option>
					                <option value="family-class">Family</option>
					            </select>
					        </div>
				    	</div>
			   
				<div class="next"><a href="#">&raquo;</a></div>
			</div>		
					
			    
		</div>-->
			    
			    <div class="row">

				    <div class="col-md-6">
						<div id="seat-map">
							<div class="front-indicator">Front</div>
							
						</div>
					</div>

					<div class="col-md-6">

						<div class="booking-details">
							<h2>Booking Details</h2>
							
							<h3> Selected Seats (<span id="counter">0</span>):</h3>
							<!--<ul id="selected-seats"></ul>
							
							Total: <b>$<span id="total">0</span></b>
							
							<button class="checkout-button">Checkout &raquo;</button>-->
							
							<div id="legend"></div>
						</div>
						
						<div class="form-group">
					        <div class="col-xs-5 col-xs-offset-3">
					        	<input id="id_flight" name="id_flight" value="563e4a5960d351744da0e345" type="hidden" />
					        	<input id="id_user" name="id_user" value="563e4767a91e193c42a5ff81" type="hidden" />
					        	<input id="row" name="row" type="hidden" />
					        	<input id="column" name="column" type="hidden" />

					        	<input id="preference" name="preference" type="hidden" />
					            <button type="submit" class="waves-effect waves-light btn checkin_completed" >Book the sit</button>
					        </div>
				    	</div>
					</div>
				</div>




		</form>

				
			</div>
	</div>

	<div class="checkin-result" style="display:none">
		<div class="container">
		<h2>Check-in Completed! </h2>
		</div>
	</div>
    
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="./js//jquery.menu-aim.js" type="text/javascript"></script>
			<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>
	<script type="text/javascript" src="js/materialize.min.js"></script>
	
    <script src="./js/app.js"></script>

    <script src="js/jquery.seat-charts.js"></script>
		

		
		<script>

			


			var firstSeatLabel = 1;
			var choice,result;
			var lookup_map = [
							[ 'c', 'Chatty' ],
							[ 's', 'Social Gamer'],
							[ 'n', 'Nappy'],
							[ 'w', 'Workaholic'],
							[ 'e', 'EasyGoing'],
							[ 'f', 'Family'],
							[ 'a', 'Empty seat']
					    ];	

			var my_map;
			var my_occupied;
			var my_col, my_row, my_pref;
			var ready= false;

			//$('#get_booking_btn').click(function() {
			

				$.ajax({
				  url: "localhost:8080/api/getflight?departure=Helsinki&destination=Rome&date=12-12-2015",
				  method: "get",
				}).done(function(data) {
				 	my_map = data.map;
				 	console.log(my_map);
				 	my_occupied = data.occupied;
				 	console.log(my_occupied);
				 	ready = true;

				});
	

			$('.checkin_completed').click(function() {
				$.ajax({

				  url: "localhost:8080/api/reservation?id_flight=563f34c0c4ac1532122b96c2&id_user=563e4767a91e193c42a5ff81"
				  +"&preference="+my_pref
				  +"&row="+my_row
				  +"&column="+my_col,
				  method: "post",
				}).done(function(data) {
				 	console.log("ADDED");
				});
			});
			    /*$("#site").cycle({
			        fx : "scrollHorz",
			        next : ".next a",
			        prev : ".prev a",
			        startingSlide : 0,
			        timeout : 0
			    });*/

			$('#c_btn').click(function() {
				hideAllComponents();
				$('.select_place').show();
				choice = 'chatty-class';

			});
			$('#s_btn').click(function() {
				hideAllComponents();
				$('.select_place').show();
				choice = 'social-class';

			});
			$('#n_btn').click(function() {
				hideAllComponents();
				$('.select_place').show();
				choice = 'nappy-class';

			});
			$('#w_btn').click(function() {
				hideAllComponents();
				$('.select_place').show();
				choice = 'workaholic-class';

			});
			$('#e_btn').click(function() {
				hideAllComponents();
				$('.select_place').show();
				choice = 'easygoing-class';

			});
	
			$(document).ready(function() {
			//$('select').on('change', function() {
  				//choice = $(this).val();
  				
  				//$(".next a").click();
  				if(ready==true) {
  					console.log(my_map);
				var $cart = $('#selected-seats'),
					$counter = $('#counter'),
					$total = $('#total'),
					sc = $('#seat-map').seatCharts({
					map: my_map,
					seats: {
						c: {
							price   : 40,
							classes : 'chatty-class', //your custom CSS class
							category: 'Economy Class'
						},
						s: {
							price   : 40,
							classes : 'social-class', //your custom CSS class
							category: 'Economy Class'
						},
						n: {
							price   : 40,
							classes : 'nappy-class', //your custom CSS class
							category: 'Economy Class'
						},
						w: {
							price   : 40,
							classes : 'workaholic-class', //your custom CSS class
							category: 'Economy Class'
						},
						e: {
							price   : 40,
							classes : 'easygoing-class', //your custom CSS class
							category: 'Economy Class'
						},
						f: {
							price   : 40,
							classes : 'family-class', //your custom CSS class
							category: 'Economy Class'
						},
						
					
					},
					naming : {
						top : false,
						getLabel : function (character, row, column) {
							return firstSeatLabel++;
						},
					},
					legend : {
						node : $('#legend'),
					    items : [
							[ 'c', 'unavailable',   'Chatty' ],
							[ 's', 'unavailable',   'Social Gamer'],
							[ 'n', 'unavailable', 	'Nappy'],
							[ 'w', 'unavailable', 	'Workaholic'],
							[ 'e', 'unavailable', 	'EasyGoing'],
							[ 'f', 'unavailable', 	'Family'],
							[ 'a', 'available',		'Empty seat']
					    ]					
					},
					click: function () {
						if (this.status() == 'available') {
							//let's create a new <li> which we'll add to the cart items
							
							console.log(choice);
							$('<li>'+this.data().category+' Seat # '+this.settings.label+': <b>$'+this.data().price+'</b> <a href="#" class="cancel-cart-item">[cancel]</a></li>')
								.attr('id', 'cart-item-'+this.settings.id)
								.data('seatId', this.settings.id)
								.appendTo($cart);

								my_col = this.settings.column;
								my_row = this.settings.row;
								var selected = $('select').find('option:selected').text();
								//sc = $('#seat-map');
								
								$.each(lookup_map, function(index, item) {
									
									if(item[1] === selected)
										my_pref = item[0];
								});
								
								//console.log(this.settings);

							
							/*
							 * Lets update the counter and total
							 *
							 * .find function will not find the current seat, because it will change its stauts only after return
							 * 'selected'. This is why we have to add 1 to the length and the current seat price to the total.
							 */
							$counter.text(sc.find('selected').length+1);
							$total.text(recalculateTotal(sc)+this.data().price);
							
							return choice + " selected";

						} else if (this.status().indexOf('selected') > -1) {
						//} else if (this.status() == 'selected') {
							//update the counter
							$counter.text(sc.find('selected').length-1);
							//and total
							$total.text(recalculateTotal(sc)-this.data().price);
						
							//remove the item from our cart
							$('#cart-item-'+this.settings.id).remove();
						
							//seat has been vacated
							return 'available';
						} else if (this.status() == 'unavailable') {
							//seat has been already booked
							return 'unavailable';
						} else {
							return this.style();
						}
					}
				});

				//this will handle "[cancel]" link clicks
				$('#selected-seats').on('click', '.cancel-cart-item', function () {
					//let's just trigger Click event on the appropriate seat, so we don't have to repeat the logic here
					sc.get($(this).parents('li:first').data('seatId')).click();
				});
				console.log(my_occupied);
				//let's pretend some seats have already been booked
				sc.get(my_occupied).status('unavailable');
			}
		
		});

		function recalculateTotal(sc) {
			var total = 0;
		
			//basically find every selected seat and sum its price
			sc.find('selected').each(function () {
				total += this.data().price;
			});
			
			return total;
		}


		</script>



  </body>
		
</html>